<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="node_modules/deepstream.io-client-js/dist/deepstream.js"></script>
        <script type="text/javascript" src="jquery-2.2.0.min.js" ></script>
    </head>
    <body>
        <div id = "login-page">
            <input id = "name" type="text" />
            <input id = "lastname" type="text" />
            <button id = "login-button">Login</button>
        </div>
        <div id = "chat-room">
            <h4>Available Users</h4>
            <ul id = "users-list"></ul>
        </div>
        <script type="text/javascript">
            //js goes here
            client = deepstream( 'localhost:6020' ).login();
            console.log('client connected');

            //input = document.querySelector( 'input' );
            var users = client.record.getRecord( 'users' );
            var user = client.record.getRecord('user');

            $('#chat-room').hide();
            $('#login-button').on('click', function(){
                console.log("button pressed!")
                var name = $('#name').val();
                var lastname = $('#lastname').val();
                
                user.set({ 'firstname': name, 'lastname': lastname })
                users.set( client.getUid(), user.get())

                

                $('#login-page').hide();
                for(var key in users.get()){
                    var li = $('<li>')
                    li.attr('id', key) 
                    li.text(users.get()[key]['firstname'] + " " + users.get()[key]['lastname'])
                    $('#users-list').append(li)
                    $('#chat-room').show();
                }
                
                users.subscribe(function( data ){
                    $('#users-list').empty();
                    for(var key in users.get()){
                        var li = $('<li>')
                        li.attr('id', key) 
                        li.text(users.get()[key]['firstname'] + " " + users.get()[key]['lastname'])
                        $('#users-list').append(li)
                    }
                });

            })


            



        </script>
    </body>
</html>